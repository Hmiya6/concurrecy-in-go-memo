# `sync.Pool`

`Pool` はオブジェクトプールパターンを並行処理で安全な形で実装したもの.  
オブジェクトプールパターンは、使うものを決まった数だけ、言い換えればプールを作る方法.

この方法はコストが高いもの (e.g. データベース接続) を作るときに数を制限して、決まった数しか作られないようにしつつ、予測できない数の操作がこれらにアクセスをリクエストできるようにするとき使う.

## `Pool` の動作
`Pool` の主なインターフェースは `Get` メソッド.  
`Get` が呼び出された時には、まずプール内に使用可能なインスタンスがあるか確認し、あれば呼び出し元にそれを返す. もしなければ、 `New` メンバー変数を呼び出し、新しいインスタンスを作成する.  
作業が終わったら、呼び出し元は `Put` を呼んで、使用していたインスタンスをプールへ戻して、他のプロセスが使えるようにする。

## 例
```go
package main

import (
	"fmt"
	"sync"
)

func main() {
	pool := &sync.Pool{
		New: func() interface{} {
			fmt.Println("Creating new instance.")
			return struct{}{}
		},
	}

	pool.Get() // ... (1)
	instance := pool.Get() // ... (1)
	pool.Put(instance) // ... (2)
	pool.Get() // ... (3)
}
```
(1) インスタンスはプール内に存在しないので `New` を呼び出す.
(2) インスタンスをプールへ戻す. 使用可能なインスタンス数は 1
(3) インスタンスがプール内に存在するため、 `New` は呼び出されない.

### 結果
```
Creating new instance.
Creating new instance.
```


